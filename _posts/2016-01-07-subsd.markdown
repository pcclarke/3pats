---
layout: post
title:  "Why aren't I getting subsidized?"
date:   2016-01-18 12:00:00
---

Following in the path of far too many governments before them, the Liberal government is considering [giving more aid to Bombardier](http://www.bloomberg.com/news/articles/2016-01-04/bombardier-an-anchor-for-canada-trudeau-briefing-memo-says). This is virtually guaranteed to be a terrible idea, because Bombadier will almost certainly come back for more money. But is that so bad? Maybe it's just the cost of placating Quebec. Unfortunately it's difficult to even judge that, because we have no idea how much money has been spent on Bombardier. The best I could find is a [$1.1 billion total since 1961](http://www.huffingtonpost.ca/mark-milke/bombardier-corporate-welfare-trap_b_4705751.html), which doesn't say how much was spent year to year, or how much provincial governments have given to Bombardier.

And as it turns out, provincial subsidies are a big deal, bigger than federal subsidies by a wide margin:

* * *

<div id="subsdTip" class="hidden">
  <p id="tipTop"><span id="tipTitle"></span></p>
  <p class="tipInfo"><span id="tipText1"></span></p>
  <p class="tipInfo"><span id="tipText2"></span></p>
</div>
<p class="subsdTitle">Total Federal and provincial government subsidies, 1961-2009</p>
<div>
  <select id="substSelect">
    <option value="nominal" selected="selected">Nominal values</option>
    <option value="inflation">Adjusted for inflation (2015 dollars)</option>
  </select>
</div>
<div id="subsdChart"></div>

* * *

Then if you break it down by province:

* * *

<p class="subsdTitle">Federal government subsidies by province, 1961-2009</p>
<div>
  <select id="subfdSelect">
    <option value="nominal" selected="selected">Nominal values</option>
    <option value="inflation">Adjusted for inflation (2015 dollars)</option>
  </select>
</div>
<div id="subfdChart"></div>

* * *

Sources:

- [Statistics Canada: CANSIM Table 384-0032]()
- [Statistics Canada: CANSIM Table 384-0010]()
- [Bank of Canada's Inflation Calculator](http://www.bankofcanada.ca/rates/related/inflation-calculator/)


<style>

#subsdChart text,
#subfdChart text {
  font-size: 10px;
}

#subsdChart .axis path,
#subsdChart .axis line,
#subfdChart .axis path,
#subfdChart .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.subsdTitle {
	font-size: 1.5em;
	margin-bottom: 0;
  text-align: center;
}

.subsdSubTitle {
	font-style: italic;
	text-align: center;
}

#subsdChart .x.axis path,
#subfdChart .x.axis path {
  display: none;
}

#subsdChart .line, 
#subfdChart .line {
  fill: none;
  stroke-linecap: "round";
  stroke: #000;
  stroke-width: 1px;
}

#subsdChart .fedLine {
	opacity: 0.5;
}

#subsdChart .provLine {

}

#subsdChart .selectLine {

}

#subsdChart .circle {
	cursor: pointer;
}

#subsdChart .fedCircle {
	fill: #000000;
}

#subsdChart .provRect {
	fill: #FFFFFF;
}

#subsdChart .selected {
	fill: red;
}

/* Tooltip */
.hidden {
  display: none;
}

#subsdTip {
  border: 1px solid black;
  border-radius: 5px;
  background-color: white;
  box-shadow: 2px 2px 2px 3px rgba(0, 0, 0, 0.05);
  position: absolute;
  width: 225px;
  height: auto;
  padding: 10px;
  pointer-events: none;
}

#subsdTip strong {
  font-weight: bold;
}

#subsdTip #tipTop {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 10px !important;
  text-transform: capitalize;
}

#subsdTip .tipInfo {
  font-size: 12px;
  margin: 0;
}

.hidden {
  display: none;
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

<script>

var coordinates = [0, 0];
var body = d3.select("body")
    .on("mousemove", function() {
      coordinates = d3.mouse(this);
    })
    .on("mousedown", function() {
      coordinates = d3.mouse(this);
    });

/*
*	Total Federal & Provincial subsidies
*/

subsdChart();
subfdChart();

function subsdChart() {

	var margin = {top: 20, right: 20, bottom: 30, left: 50},
	    width = 740 - margin.left - margin.right,
	    height = 300 - margin.top - margin.bottom;

	var parseDate = d3.time.format("%Y").parse;

	var format = d3.format(",.0");

	var dataColours = ["#FF0000", "#808080"];

	var x = d3.time.scale()
	    .range([0, width]);

	var y = d3.scale.linear()
	    .range([height, 0]);

	var xAxis = d3.svg.axis()
	    .scale(x)
	    .orient("bottom");

	var yAxis = d3.svg.axis()
	    .scale(y)
	    .orient("left");

	var selectedOpt = "nominal";

	var lineStart = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(0); });

  var nominalLine = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(d.nominal); });

  var infLine = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(d["inflation-adjusted"]); });

	var svg = d3.select("#subsdChart").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("{{ site.baseurl }}/data/2016/01/subsd_can.csv", type, function(error, data) {
	  if (error) throw error;

	  x.domain([d3.min(data, function(d) { return d.year; }), 
	  	d3.max(data, function(d) { return d.year; })]);
	  y.domain([d3.min(data, function(d) { return d.nominal; }), 
	  	d3.max(data, function(d) { return d["inflation-adjusted"]; })]);

	  var nestData = d3.nest()
	  	.key(function(d) { return d.government; })
	  	.entries(data);

	  var subsd = svg.selectAll(".subsd")
	      .data(nestData)
	    .enter().append("g")
	      .attr("class", "subsd");

    var lines = subsd.append("path")
      .attr("class", function(d) {
      	if (d.key === "federal") {
      		return "line fedLine";
      	} else {
      		return "line provLine";
      	}
      	return "line";
      })
      .attr("d", function(d) { return lineStart(d.values); });

		lines.transition()
			.duration(1000)
			.attr("d", function(d) { return nominalLine(d.values); });

		var circleGroup = subsd.append("g")
			.attr("class", "circle-group");

		var circles = circleGroup.selectAll("circles")
			.data(function(d) { return d.values; })
			.enter()
			.append("circle")
			.attr("class", function(d) {
				if (d.government === "federal") {
					return "circle fedCircle";
				} else {
					return "circle provRect";
				}
			})
			.attr("cx", function(d) {  return x(d.year); })
			.attr("cy", function(d) { return y(1); })
			.attr("r", 2)
			.on("mouseover", function(d) { 
				showTooltip(d);
				d3.select(this).classed("selected", true);
			})
			.on("mouseout", function(d) { 
				d3.select("#subsdTip").classed("hidden", true); 
				d3.select(this).classed("selected", false);
			});

		circles.transition()
			.duration(1000)
			.attr("cy", function(d) { return y(d.nominal); });

	  svg.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + height + ")")
	      .call(xAxis);

	  var yAxisLine = svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis);

	  var yAxisLabel = yAxisLine.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 6)
	      .attr("dy", ".71em")
	      .style("text-anchor", "end")
	      .text("Million dollars");

		function showTooltip(d) {
			var xPos = coordinates[0] + 15;
        if (x(d.year) > width / 2) {
          xPos = coordinates[0] - 250;
        }
        var yPos = coordinates[1];
        d3.select("#subsdTip")
          .style("left", xPos + "px")
          .style("top", yPos + "px");

				d3.select("#subsdTip")
          .select("#tipTitle").text(d.government + " subsidies â€“ " + d.year.getFullYear());
        if (selectedOpt === "nominal") {
        	d3.select("#subsdTip")
          	.select("#tipText1")
          	.text("$" + format(d.nominal) + " million dollars");
        } else {
        	d3.select("#subsdTip")
          	.select("#tipText1")
          	.text("$" + d["inflation-adjusted"] + " million dollars");
        }
        d3.select("#subsdTip")
          .select("#tipText2").text(d.source);

        d3.select("#subsdTip").classed("hidden", false);
		}

  d3.select("#substSelect")
		.on("change", selected);

		function selected() {
			selectedOpt = this.options[this.selectedIndex].value;
			if (selectedOpt === "nominal") {
				lines.transition()
					.duration(1000)
					.attr("d", function(d) { return nominalLine(d.values); });
				circles.transition()
					.duration(1000)
					.attr("cy", function(d) { return y(d.nominal); });
			} else {
				lines.transition()
					.duration(1000)
					.attr("d", function(d) { return infLine(d.values); });
				circles.transition()
					.duration(1000)
					.attr("cy", function(d) { return y(d["inflation-adjusted"]); });
			}
		}
	});

	function type(d) {
		d.year = parseDate(d.year);
		d.nominal = +d.nominal;
		d["inflation-adjusted"] = +d["inflation-adjusted"];

    return d;
	}

}

/*
*
* Federal subsidies by province
*
*/

function subfdChart() {

	var margin = {top: 20, right: 20, bottom: 30, left: 50},
	    width = 740 - margin.left - margin.right,
	    height = 300 - margin.top - margin.bottom;

	var parseDate = d3.time.format("%Y").parse;

	var format = d3.format(",.0");

	var dataColours = ["#FF0000", "#808080"];

	var x = d3.time.scale()
	    .range([0, width]);

	var y = d3.scale.linear()
	    .range([height, 0]);

	var xAxis = d3.svg.axis()
	    .scale(x)
	    .orient("bottom");

	var yAxis = d3.svg.axis()
	    .scale(y)
	    .orient("left");

	var selectedOpt = "nominal";

	var lineStart = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(0); });

  var nominalLine = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(d.nominal); });

  var infLine = d3.svg.line()
	  .x(function(d) { return x(d.year); })
	  .y(function(d) { return y(d["inflation-adjusted"]); });

	var svg = d3.select("#subfdChart").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("{{ site.baseurl }}/data/2016/01/subsd_fed.csv", type, function(error, data) {
	  if (error) throw error;

	  x.domain([d3.min(data, function(d) { return d.year; }), 
	  	d3.max(data, function(d) { return d.year; })]);
	  y.domain([d3.min(data, function(d) { return d.nominal; }), 
	  	d3.max(data, function(d) { return d["inflation-adjusted"]; })]);

	  var nestData = d3.nest()
	  	.key(function(d) { return d.government; })
	  	.entries(data);

	  var subsd = svg.selectAll(".subsd")
	      .data(nestData)
	    .enter().append("g")
	      .attr("class", "subsd");

    var lines = subsd.append("path")
      .attr("class", function(d) {
      	if (d.key === "federal") {
      		return "line fedLine";
      	} else {
      		return "line provLine";
      	}
      	return "line";
      })
      .attr("d", function(d) { return lineStart(d.values); });

		lines.transition()
			.duration(1000)
			.attr("d", function(d) { return nominalLine(d.values); });

		var circleGroup = subsd.append("g")
			.attr("class", "circle-group");

		var circles = circleGroup.selectAll("circles")
			.data(function(d) { return d.values; })
			.enter()
			.append("circle")
			.attr("class", function(d) {
				if (d.government === "federal") {
					return "circle fedCircle";
				} else {
					return "circle provRect";
				}
			})
			.attr("cx", function(d) {  return x(d.year); })
			.attr("cy", function(d) { return y(1); })
			.attr("r", 2)
			.on("mouseover", function(d) { 
				showTooltip(d);
				d3.select(this).classed("selected", true);
			})
			.on("mouseout", function(d) { 
				d3.select("#subsdTip").classed("hidden", true); 
				d3.select(this).classed("selected", false);
			});

		circles.transition()
			.duration(1000)
			.attr("cy", function(d) { return y(d.nominal); });

	  svg.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + height + ")")
	      .call(xAxis);

	  var yAxisLine = svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis);

	  var yAxisLabel = yAxisLine.append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 6)
	      .attr("dy", ".71em")
	      .style("text-anchor", "end")
	      .text("Million dollars");

		function showTooltip(d) {
			var xPos = coordinates[0] + 15;
        if (x(d.year) > width / 2) {
          xPos = coordinates[0] - 250;
        }
        var yPos = coordinates[1];
        d3.select("#subsdTip")
          .style("left", xPos + "px")
          .style("top", yPos + "px");

				d3.select("#subsdTip")
          .select("#tipTitle").text(d.government + " subsidies â€“ " + d.year.getFullYear());
        if (selectedOpt === "nominal") {
        	d3.select("#subsdTip")
          	.select("#tipText1")
          	.text("$" + format(d.nominal) + " million dollars");
        } else {
        	d3.select("#subsdTip")
          	.select("#tipText1")
          	.text("$" + d["inflation-adjusted"] + " million dollars");
        }
        d3.select("#subsdTip")
          .select("#tipText2").text(d.source);

        d3.select("#subsdTip").classed("hidden", false);
		}

  d3.select("#subfdSelect")
		.on("change", selected);

		function selected() {
			selectedOpt = this.options[this.selectedIndex].value;
			if (selectedOpt === "nominal") {
				lines.transition()
					.duration(1000)
					.attr("d", function(d) { return nominalLine(d.values); });
				circles.transition()
					.duration(1000)
					.attr("cy", function(d) { return y(d.nominal); });
			} else {
				lines.transition()
					.duration(1000)
					.attr("d", function(d) { return infLine(d.values); });
				circles.transition()
					.duration(1000)
					.attr("cy", function(d) { return y(d["inflation-adjusted"]); });
			}
		}
	});

	function type(d) {
		d.year = parseDate(d.year);
		d.nominal = +d.nominal;
		d["inflation-adjusted"] = +d["inflation-adjusted"];

    return d;
	}
 
}

</script>